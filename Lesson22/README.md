# VPN 

## Описание/Пошаговая инструкция выполнения домашнего задания:

Для выполнения домашнего задания используйте методичку:
https://drive.google.com/file/d/17b-DlGINS1EWyaXlHvG6z7tolPZrPAYq/view?usp=share_link
Что нужно сделать?

1. Между двумя виртуалками поднять vpn в режимах

   * tun;
   * tap;
     Прочуствовать разницу.

2. Поднять RAS на базе OpenVPN с клиентскими сертификатами, подключиться с локальной машины на виртуалку.
3. Самостоятельно изучить, поднять ocserv и подключиться с хоста к виртуалке*

Формат сдачи ДЗ - vagrant + ansible

## Решение

### Тестирование скорости в режиме TUN.

#### Настройка окружения

В файле provisioning/defaults/main.yml установить
```
vpn_mode: tun
```

Создать окружения
```
vagrant up --no-provision
vagrant up --provision
```

#### Замер производительности

На сервере запустить iperf3 в качестве сервера:
```
vagrant ssh server
sudo -i
iperf3 -s &
```

На клиенте, как клиент:
```
vagrant ssh client
sudo -i
iperf3 -c 10.10.10.1 -t 40 -i 5
```

где -t - время замера в секундах, -i - интервал времени вывода информации на экран.

#### Результаты замера

**Server**

![server-tun](imgs/server-tun.png)

**Client**

![server-tun](imgs/server-tun.png)

### Тестирование скорости в режиме TAP.

#### Настройка окружения

В файле provisioning/defaults/main.yml установить
```
vpn_mode: tap
```

Выполнить настройку
```
vagrant up --provision
```

#### Замер производительности

На сервере запустить iperf3 в качестве сервера:
```
vagrant ssh server
sudo -i
iperf3 -s &
```

На клиенте, как клиент:
```
vagrant ssh client
sudo -i
iperf3 -c 10.10.10.1 -t 40 -i 5
```

#### Результаты замера

**Server**

![server-tap](imgs/server-tap.png)

**Client**

![server-tap](imgs/server-tap.png)

### Вывод по сравнению скорости TUN и TAP

В моём случае в режиме TAP за 40 секунд было передно 946 MBytes со средней скоростью 198 Mbits/sec , в режиме TUN было передано 1,13 GBytes со средней скоростью 243 Mbits/sec. Исходя из этих результатов можно сделать вывод, что производительнось в режиме TUN выше.

### Прочуствовать разницу

Режимы TUN и TAP работают на разных уровнях модели сетевого взаимодействия OSI. 
TAP работает на канальном уровне OSI. TUN работает на сетевом уровне OSI.
TAP применяется для создания сетевых мостов, а TUN – для маршрутизации. 

![OSI](imgs/OSI.png)


### 2. RAS на базе OpenVPN

**Определение - что означает сервер удаленного доступа (RAS)?**

Сервер удаленного доступа (RAS) - это тип сервера, который предоставляет набор услуг для удаленно подключенных пользователей через сеть или Интернет. Он работает как удаленный шлюз или центральный сервер, который соединяет удаленных пользователей с внутренней локальной сетью организации (LAN).

#### Настройка окружения

**__Note:__** Подсмотрено у https://github.com/UtrGrd/otus_hw_34_VPN

Перейти в директорию ras и выполнить настройку:
```
vagrant up --no-provision
vagrant up --provision
```

#### Описание

Используются подобные первому заданию два виртуальных сервера: server и client в которые добавляются ещё по одному интерфейсу с локальными сетями: 172.16.10.0/24 и 172.16.20.0/24. Это позволит эмулировать наличие других сетей за пределами server и client, и настроить маршрутизацию между ними. Для того, чтобы маршрутизация работала, необходимо в конфигурационном файле сервера добавить следующие строки:

```
route 172.16.20.0 255.255.255.0
push "route 172.16.10.0 255.255.255.0"
```

На клиенте создаётся файл /etc/openvpn/client/client со следующим содержимым:
```
iroute 172.16.20.0 255.255.255.0
```

**На сервере**

Со стороны сервера проверяем маршрутизацию и доступность сети 172.16.20.0/24 привязанную к клиенту.

![server-output](imgs/ras/server-output.png)

**На клиенте**

Со стороны клиента проверяем маршрутизацию и доступность сети 172.16.10.0/24 привязанную к серверу.

![client-output](imgs/ras/client-output.png)

#### Вывод

Сети доступны, всё работает корректно.




